<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>標籤</title>
    <script src="https://code.jquery.com/jquery-3.3.1.min.js" integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8=" crossorigin="anonymous"></script>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.6.2/dist/css/bootstrap.min.css" integrity="sha384-xOolHFLEh07PJGoPkLv1IbcEPTNtaed2xpHsD9ESMhqIYd0nLMwNLD69Npy4HI+N" crossorigin="anonymous">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.6.2/dist/js/bootstrap.min.js" integrity="sha384-+sLIOodYLS7CIrQpBjl+C7nPvqq+FbNUBDunl/OZv93DB7Ln/533i8e/mZXLi/P+" crossorigin="anonymous"></script>
    <!-- 網站用版本 4.6 -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.2.0/css/all.min.css">
    <link id="sleek-css" rel="stylesheet" href="css/admin.css?id=a3617cb76c3aa6234410eb11f813f3b1">
    <script src="http://static.runoob.com/assets/jquery-validation-1.14.0/lib/jquery.js"></script>
    <script src="http://static.runoob.com/assets/jquery-validation-1.14.0/dist/jquery.validate.min.js"></script>
    <style>
        .s_img_labeBox{ position: relative; }
        .s_img_labeBox span { display: inline-block; padding: 2px 10px; border: 2px solid rgb(227, 76, 0); background: rgb(227, 76, 0);  color: rgb(255, 255, 255); font-size: 14px; position: absolute; cursor: pointer;}
        .s_img_labeBox span.active{border: 2px dashed #000; background: red;}
    </style>
</head>
<body>
    <div class="card-body pt-0">
        <form method="POST" action="https://rdm.geekers.tw/estate/change_background" accept-charset="UTF-8" id="changeBgForm" enctype="multipart/form-data"><input name="_token" type="hidden" value="2vrgaVrW81v5dvyxzOQ29ySod5cd8hTSjbPVZAxV">
            <input type="hidden" name="company" value="2">
            <input type="hidden" name="case" value="1">
            <input type="file" class="d-none" name="background" id="background" accept="image/png,image/jpeg">
        </form>

    <!-- 添加標籤 -->
    <div class="d-flex flex-row justify-content-between pt-1">
        <div class="d-flex w-100">
            <div class="search-input-group">
                <div>
                    <!-- 標籤名稱 -->
                    <input type="text" class="form-control" id="s_titleinputLabel">
                </div>
            </div>
            <div class="search-btn-group text-nowrap">
                <!-- 新增按鈕 -->
                <button type="button" class="btn btn-gk-view" id="s_addbuttonLabel">添加標籤</button>
                <div class="d-none">
                    <input type="file" id="s_ImageLabelfile">更換圖片
                </div>
                <button type="button" class="btn btn-gk-view" id="s_ImageLabel">更換照片</button>
                <button type="button" class="btn btn-gk-print" id="s_SavebuttonLabel">儲存標籤</button>
                <button type="button" class="btn btn-secondary" id="s_Clearbtn">清除</button>
            </div>
        </div>
    </div>
    <!-- 選擇區域、棟別、樓層、戶 -->
    <div class="d-flex" id="s_ChangeTypeImage">
        <div class="form-group mt-4">
            <select class="form-control" data-status="area">
                <option value="A0">A</option>
                <option value="A1">B</option>
            </select>
        </div>
        <!-- <div class="form-group mt-4">
            <select class="form-control" data-status="building">
            <option value="0">棟別</option>
            <option value="A">A</option>
            <option value="B">B</option>
            </select>
        </div> -->
        <div class="form-group mt-4">
            <select class="form-control" data-status="floor">
            <option value="0">樓層</option>
            <option value="30">1樓</option>
            <option value="50">2樓</option>
            <option value="31">3樓</option>
            </select>
        </div>
        <div class="form-group mt-4">
            <select class="form-control" data-status="household">
            <option value="0">戶別</option>
            <option value="11">1</option>
            <option value="12">2</option>
            <option value="14">3</option>
            </select>
        </div>
    </div>
    <div class="s_BtnGroud my-2">
        <button type="button" class="btn btn-gk-view text-secondary border" data-simg="left"><i class="fa-solid fa-left-long"></i></button>
        <button type="button" class="btn btn-gk-view text-secondary border" data-simg="up"><i class="fa-solid fa-up-long"></i></button>
        <button type="button" class="btn btn-gk-view text-secondary border" data-simg="down"><i class="fa-solid fa-down-long"></i></button>
        <button type="button" class="btn btn-gk-view text-secondary border" data-simg="right"><i class="fa-solid fa-right-long"></i></button>
    </div>
    <!-- 添加標籤 end-->
        <div id="s_ImageLabelAll">
            <div class="s_img_labeBox active" data-imgidbox="A0" data-labelname="imgbox">
                <!-- 區 -->
                <img src="b1.png" class="img-fluid" alt="" style="width: 100%;height: auto">
            </div>
            <div class="s_img_labeBox d-none" data-imgidbox="A1" data-labelname="imgbox">
                <!-- 區 -->
                <!-- <img src="b2.png" class="img-fluid" alt="" style="width: 100%;height: auto"> -->
            </div>
            <div class="s_img_labeBox d-none" data-imgidbox="A0_F30" data-labelname="imgbox">
                <!-- 樓 -->
                <img src class="img-fluid" alt="" style="width: 100%;height: auto">
            </div>
            <div class="s_img_labeBox d-none" data-imgidbox="A0_F50" data-labelname="imgbox">
                <!-- 樓 -->
                <img src="b1.png" class="img-fluid" alt="" style="width: 100%;height: auto">
            </div>
            <div class="s_img_labeBox d-none" data-imgidbox="A0_F30_H11" data-labelname="imgbox">
                <!-- 樓 -->
                <img src="b1.png" class="img-fluid" alt="" style="width: 100%;height: auto">
            </div>
            <div class="s_img_labeBox d-none" data-imgidbox="A0_F30_H12" data-labelname="imgbox">
                <!-- 樓 -->
                <img src="b2.png" class="img-fluid" alt="" style="width: 100%;height: auto">
            </div>
            <div class="s_img_labeBox d-none" data-imgidbox="A0_F50_H11" data-labelname="imgbox">
                <!-- 樓 -->
                <img src="" class="img-fluid" alt="" style="width: 100%;height: auto">
            </div>
            <div class="s_img_labeBox d-none" data-imgidbox="A1_B_F2" data-labelname="imgbox">
                <!-- 樓 -->
                <img src="b2.png" class="img-fluid" alt="" style="width: 100%;height: auto">
            </div>
            <div class="s_img_labeBox d-none" data-imgidbox="A0_F31" data-labelname="imgbox">
                <!-- 樓 -->
                <img src="b2.png" class="img-fluid" alt="" style="width: 100%;height: auto">
            </div>
            <div class="s_img_labeBox d-none" data-imgidbox="B1_A_F2" data-labelname="imgbox">
                <!-- 樓 -->
                <img src="b2.png" class="img-fluid" alt="" style="width: 100%;height: auto">
            </div>
            <div class="s_img_labeBox d-none" data-imgidbox="A1_A_F1_H1" data-labelname="imgbox">
                <!-- 戶 -->
                <img src="b1.png" class="img-fluid" alt="" style="width: 100%;height: auto">
            </div>
            <div class="s_img_labeBox d-none" data-imgidbox="A0_F50_H14" data-labelname="imgbox">
                <!-- 戶 -->
                <img src="b1.png" class="img-fluid" alt="" style="width: 100%;height: auto">
            </div>
            <div class="s_img_labeBox d-none" data-imgidbox="A2_A_F2_H1" data-labelname="imgbox">
                <!-- 戶 -->
                <img src="b1.png" class="img-fluid" alt="" style="width: 100%;height: auto">
            </div>
            <div class="s_img_labeBox d-none" data-imgidbox="A2_B_F1_H1" data-labelname="imgbox">
                <!-- 戶 -->
                <img src="b1.png" class="img-fluid" alt="" style="width: 100%;height: auto">
            </div>
            <div class="s_img_labeBox d-none" data-imgidbox="A2_B_F2_H1" data-labelname="imgbox">
                <!-- 戶 -->
                <img src="b1.png" class="img-fluid" alt="" style="width: 100%;height: auto">
            </div>
            <div class="s_img_labeBox d-none" data-imgidbox="A2_A_F1_H2" data-labelname="imgbox">
                <!-- 戶 -->
                <img src="b1.png" class="img-fluid" alt="" style="width: 100%;height: auto">
            </div>
            <div class="s_img_labeBox d-none" data-imgidbox="A2_A_F2_H2" data-labelname="imgbox">
                <!-- 戶 -->
                <img src="b1.png" class="img-fluid" alt="" style="width: 100%;height: auto">
            </div>
            <div class="s_img_labeBox d-none" data-imgidbox="A2_B_F1_H2" data-labelname="imgbox">
                <!-- 戶 -->
                <img src="b1.png" class="img-fluid" alt="" style="width: 100%;height: auto">
            </div>
            <div class="s_img_labeBox d-none" data-imgidbox="A2_B_F2_H2" data-labelname="imgbox">
                <!-- 戶 -->
                <img src="b1.png" class="img-fluid" alt="" style="width: 100%;height: auto">
            </div>
            <div class="s_img_labeBox d-none" data-imgidbox="A1_B_F1_H1" data-labelname="imgbox">
                <!-- 戶 -->
                <img src="b1.png" class="img-fluid" alt="" style="width: 100%;height: auto">
            </div>
            <div class="s_img_labeBox d-none" data-imgidbox="A2_A_F1" data-labelname="imgbox">
                <!-- 戶 -->
                <img src="b1.png" class="img-fluid" alt="" style="width: 100%;height: auto">
            </div>
            <div class="s_img_labeBox d-none" data-imgidbox="A2_B_F2" data-labelname="imgbox">
                <!-- 戶 -->
                <img src="b1.png" class="img-fluid" alt="" style="width: 100%;height: auto">
            </div>
            <div class="s_img_labeBox d-none" data-imgidbox="A2_A_F2" data-labelname="imgbox">
                <!-- 戶 -->
                <img src="b1.png" class="img-fluid" alt="" style="width: 100%;height: auto">
            </div>
            <div class="s_img_labeBox d-none" data-imgidbox="A1_A_F1_H2" data-labelname="imgbox">
                <!-- 戶 -->
                <img src="b1.png" class="img-fluid" alt="" style="width: 100%;height: auto">
            </div>
            <div class="s_img_labeBox d-none" data-imgidbox="A1_A_F2_H1" data-labelname="imgbox">
                <!-- 戶 -->
                <img src="b1.png" class="img-fluid" alt="" style="width: 100%;height: auto">
            </div>
            <div class="s_img_labeBox d-none" data-imgidbox="A1_A_F2_H2" data-labelname="imgbox">
                <!-- 戶 -->
                <img src="b1.png" class="img-fluid" alt="" style="width: 100%;height: auto">
            </div>
            <div class="s_img_labeBox d-none" data-imgidbox="A1_B_F2_H1" data-labelname="imgbox">
                <!-- 戶 -->
                <img src="b1.png" class="img-fluid" alt="" style="width: 100%;height: auto">
            </div>
            <div class="s_img_labeBox d-none" data-imgidbox="A1_B_F2_H2" data-labelname="imgbox">
                <!-- 戶 -->
                <img src="b1.png" class="img-fluid" alt="" style="width: 100%;height: auto">
            </div>
            <div class="s_img_labeBox d-none" data-imgidbox="A0_F50_H12" data-labelname="imgbox">
                <!-- 戶 -->
                <img src="b2.png" class="img-fluid" alt="" style="width: 100%;height: auto">
            </div>
        </div>
    </div>

    <script>
        //預設值
        const presetValue = "A0";
        //標籤按鈕，新增移除效果
        //屬性設定：
        // data-labelname='span' ==  標籤用<span>
        // data-labelname='addbutton' ==  新增用<button>
        // data-labelname='delbutton' ==  移除用<button>
        // data-labelname='move' == 移動<button>
        // data-labelname="titleinput" ==  標題用<input>
        // data-labelname="imgbox" ==  圖片外框
        //id規則： s_Label_1 ~ s_Label_10 不可以重複
        let ssidname = "s_Label";
        let ssLabelsPan = "<span data-labelname='span'></span>";
        //這邊的Key要與AllLabeljson 階層key相同 (包含順序)
        //ex: A0_F30_H11 (A0區域、F樓層+id、戶+id)，也需要對應圖片外框 data-imgidbox="A0_F50_H12"
        // Select 的 value也要有對應到
        // <a href="#" class="s_img_labeBox d-none" data-imgidbox="A0_F50_H12" data-labelname="imgbox">
        let AllJsonKEy = {"area":"A","floor":"F","household":"H"};
        //圖片區塊
        const ImageLabelAll = document.getElementById('s_ImageLabelAll');
        //名稱輸入
        const s_titleinputLabel = document.getElementById('s_titleinputLabel');
        //清除按鈕
        const s_Clearbtn = $('#s_Clearbtn');
        //取得Select
        let areavalue = document.querySelector('[data-status="area"]');
        let floorvalue = document.querySelector('[data-status="floor"]');
        let householdvalue = document.querySelector('[data-status="household"]');

        //清除按鈕
        s_Clearbtn.on('click',function(event){
            areavalue.value = presetValue;
            floorvalue.value = 0;
            householdvalue.value = 0;
            //初始化
            Clear_OldIMAgeFirstBox(householdvalue,"clear");
        });

        //== 標籤開始
        //== 1.Demoobj ==//
        let AllLabeljson = {
                "List": {
                    "area":[
                            {
                                "name":"全区资料",
                                "tag":"A0",
                                "id":0,
                                "img": "b1.png",
                                "label": [
                                    {"name":"A區域標籤1","id":1,"left":100,"top":200},
                                    {"name":"A區域標籤2","id":2,"left":200,"top":""},
                                    {"name":"A區域標籤3","id":6},
                                    {"name":"A區域標籤4","id":10,"left":900,"top":10},
                                    {"name":"A區域標籤5","id":13,"left":"","top":1100},
                                ],
                                "floor": [
                                    {
                                        "name":"1樓",
                                        "tag":"A0_F30",
                                        "id":30,
                                        "img": "b2.png",
                                        "label": [
                                            {"name":"A區1樓(A0_F30)1","id":1,"left":100,"top":200},
                                            {"name":"A區1樓(A0_F30)2","id":2,"left":200,"top":""},
                                            {"name":"A區1樓(A0_F30)3","id":6},
                                            {"name":"A區1樓(A0_F30)4","id":10,"left":900,"top":10},
                                            {"name":"A區1樓(A0_F30)5","id":13,"left":"","top":100},
                                        ],
                                        "household": [
                                            {
                                                "name":"2戶",
                                                "tag":"A0_F30_H11",
                                                "id":11,
                                                "img": "b2.png",
                                                "label": [
                                                    {"name":"A區1樓2戶(A0_F30_H11)1","id":1,"left":100,"top":200},
                                                    {"name":"A區1樓2戶(A0_F30_H11)2","id":2,"left":200,"top":""},
                                                    {"name":"A區1樓2戶(A0_F30_H11)3","id":6},
                                                    {"name":"A區1樓2戶(A0_F30_H11)4","id":10,"left":900,"top":10},
                                                    {"name":"A區1樓2戶(A0_F30_H11)5","id":13,"left":"","top":1100},
                                                ],
                                            },
                                            {
                                                "name":"1戶",
                                                "tag":"A0_F30_H12",
                                                "id":12,
                                                "img": "b2.png",
                                                "label": [
                                                    {"name":"A區1樓1戶(A0_F30_H12)1","id":1,"left":100,"top":200},
                                                    {"name":"A區1樓1戶(A0_F30_H12)2","id":2,"left":200,"top":""},
                                                    {"name":"A區1樓1戶(A0_F30_H12)3","id":6},
                                                    {"name":"A區1樓1戶(A0_F30_H12)4","id":10,"left":900,"top":10},
                                                    {"name":"A區1樓1戶(A0_F30_H12)5","id":13,"left":"","top":1100},
                                                ],
                                            },
                                        ]
                                    },
                                    {
                                        "name":"2樓",
                                        "tag":"A0_F50",
                                        "id":50,
                                        "img": "b2.png",
                                        "label": [
                                            {"name":"A區2樓(A0_F50)1","id":1,"left":100,"top":200},
                                            {"name":"A區2樓(A0_F50)2","id":2,"left":200,"top":""},
                                            {"name":"A區2樓(A0_F50)3","id":6},
                                            {"name":"A區2樓(A0_F50)4","id":10,"left":900,"top":10},
                                            {"name":"A區2樓(A0_F50)5","id":13,"left":"","top":100},
                                        ],
                                        "household": [
                                            {
                                                "name":"1戶",
                                                "tag":"A0_F50_H12",
                                                "id":12,
                                                "img": "b2.png",
                                                "label": [
                                                    {"name":"A區2樓1戶(A0_F50_H12)1","id":1,"left":100,"top":200},
                                                    {"name":"A區2樓1戶(A0_F50_H12)2","id":2,"left":200,"top":""},
                                                    {"name":"A區2樓1戶(A0_F50_H12)3","id":6},
                                                    {"name":"A區2樓1戶(A0_F50_H12)4","id":10,"left":900,"top":10},
                                                    {"name":"A區2樓1戶(A0_F50_H12)5","id":13,"left":"","top":1100},
                                                ],
                                            },
                                            {
                                                "name":"2戶",
                                                "tag":"A0_F50_H11",
                                                "id":11,
                                                "img": "b2.png",
                                                "label": [
                                                    {"name":"A區2樓2戶(A0_F50_H11)1","id":1,"left":100,"top":200},
                                                    {"name":"A區2樓2戶(A0_F50_H11)2","id":2,"left":200,"top":""},
                                                    {"name":"A區2樓2戶(A0_F50_H11)3","id":6},
                                                    {"name":"A區2樓2戶(A0_F50_H11)4","id":10,"left":900,"top":10},
                                                    {"name":"A區2樓2戶(A0_F50_H11)5","id":13,"left":"","top":1100},
                                                ],
                                            },
                                            {
                                                "name":"3戶",
                                                "tag":"A0_F50_H14",
                                                "id":14,
                                                "img": "b1.png",
                                                "label": [
                                                    {"name":"A區2樓3戶(A0_F50_H14)1","id":1,"left":100,"top":200},
                                                    {"name":"A區2樓3戶(A0_F50_H14)2","id":2,"left":200,"top":""},
                                                    {"name":"A區2樓3戶(A0_F50_H14)3","id":6},
                                                    {"name":"A區2樓3戶(A0_F50_H14)4","id":10,"left":900,"top":10},
                                                    {"name":"A區2樓3戶(A0_F50_H14)5","id":13,"left":"","top":1100},
                                                ],
                                            },
                                        ]
                                    },
                                    {
                                        "name":"3樓",
                                        "tag":"A0_F31",
                                        "id":31,
                                        "img": "b2.png",
                                        "label": [
                                            {"name":"A區3樓(A0_F31)1","id":1,"left":100,"top":200},
                                            {"name":"A區3樓(A0_F31)2","id":2,"left":200,"top":""},
                                            {"name":"A區3樓(A0_F31)3","id":6},
                                            {"name":"A區3樓(A0_F31)4","id":10,"left":900,"top":10},
                                            {"name":"A區3樓(A0_F31)5","id":13,"left":"","top":100},
                                        ],
                                    }

                                ],
                            },
                            {
                                "name":"全区资料",
                                "tag":"A1",
                                "id":1,
                                "img": "b1.png",
                                "label": [
                                    {"name":"B區域標籤1","id":1,"left":100,"top":200},
                                    {"name":"B區域標籤2","id":2,"left":200,"top":""},
                                    {"name":"B區域標籤3","id":6},
                                    {"name":"B區域標籤4","id":10,"left":900,"top":10},
                                    {"name":"B區域標籤5","id":13,"left":"","top":1100},
                                ],
                            }

                        ]
                }
            };

        //載入標籤(這裡需要丟Label進來)
        function S_LabelLOAD(json)
        {
            //整理好的json
            let Imagejson = json;
            //label長度
            let LabelLength = Imagejson ? Imagejson.length : 0;

            if(LabelLength > 0 )
            {
                let LabeHtml = '';
                Imagejson.forEach(item=>{
                    LabeHtml += "<span data-labelname='span' data-labelid='"+item.id+"' style='top:"+(item.top != "" && item.top ? item.top : "8")+"px; left:"+(item.left != "" && item.left ? item.left : "8")+"px;'>"+item.name+"</span>";
                });

                //目前顯示的圖片
                if(document.querySelector('.s_img_labeBox.active'))
                {
                    //清除舊標籤
                    let spanAll = document.querySelectorAll('[data-labelname="span"]');
                        spanAll.forEach(item=>{
                            item.remove();
                    });
                    let SthisImage = $('.s_img_labeBox.active');
                    SthisImage.append(LabeHtml);
                }

            }
        }

        //載入標籤(//預設顯示A區)
        S_LabelLOAD(AllLabeljson['List']['area'][0].label);


        //選取標籤
        ImageLabelAll.addEventListener("click",(event)=>{
            let target = event.target;
            let labelname = ('labelname' in target.dataset) ? target.dataset.labelname : false;
            if(labelname == "span")
            {
                if(document.querySelector("span[data-labelname='span'].active"))
                {
                    document.querySelector("span[data-labelname='span'].active").classList.remove('active');
                }

                target.classList.add('active');
                s_titleinputLabel.value = document.querySelector("span[data-labelname='span'].active").textContent;
            }
        });

        //移動標籤
        $(".s_BtnGroud button").on('click',function(event){
            //先找尋是否有標籤被選取了
            if(document.querySelector("span[data-labelname='span'].active"))
            {
                let s_Span = document.querySelector("span[data-labelname='span'].active");
                switch($(this).data('simg'))
                {
                    case "left":
                        if(s_Span.style.left != "" || s_Span.style.left !=null)
                        {
                            let s_SpanWidth = s_Span.offsetWidth;
                            let oldleft = s_Span.style.left;
                            let oldleftnumber = oldleft.split('px');
                            let newleft = Number(oldleftnumber[0]) - 10;
                            let leftvalue = (newleft <= 0 ) ? 0  : newleft;
                            s_Span.style.left = leftvalue + "px";
                            let spanid = s_Span.dataset.labelid;
                            thisPositionImageJson(spanid,"left",leftvalue);
                        }
                        break;
                    case "right":
                        if(s_Span.style.left != "" || s_Span.style.left !=null)
                        {
                            //圖片外框寬度
                            let ImageWidths = document.querySelector('.s_img_labeBox.active') !=null ? document.querySelector('.s_img_labeBox.active').offsetWidth : false;

                            let s_SpanWidth = s_Span.offsetWidth;
                            let oldleft = s_Span.style.left;
                            let oldleftnumber = oldleft.split('px');
                            let newleft = Number(oldleftnumber[0]) + 10;
                            let leftvalue = (newleft > (ImageWidths - s_SpanWidth)) ? ImageWidths : newleft;
                            s_Span.style.left = leftvalue + "px";
                            let spanid = s_Span.dataset.labelid;
                            thisPositionImageJson(spanid,"left",leftvalue);
                        }
                        break;
                        case "up":
                            if(s_Span.style.top != "" || s_Span.style.top !=null)
                            {
                                let oldtop = s_Span.style.top;
                                let oldtopnumber = oldtop.split('px');
                                let newtop = Number(oldtopnumber[0]) - 10;
                                let topvalue = (newtop <= 0 ) ? 0  : newtop;
                                s_Span.style.top = topvalue + "px";
                                let spanid = s_Span.dataset.labelid;
                                thisPositionImageJson(spanid,"top",topvalue);
                            }
                        break;
                        case "down":
                            if(s_Span.style.top != "" || s_Span.style.top !=null)
                            {
                                //圖片高度
                                let ImageHeight = document.querySelector('.s_img_labeBox.active img').offsetHeight !=null ? document.querySelector('.s_img_labeBox.active img').offsetHeight : false;
                                let s_SpanHeight = s_Span.offsetHeight;
                                let oldtop = s_Span.style.top;
                                let oldtopnumber = oldtop.split('px');
                                let newtop = Number(oldtopnumber[0]) + 10;
                                let topvalue = (newtop >= (ImageHeight - s_SpanHeight) ) ?  ImageHeight : newtop;
                                s_Span.style.top =  topvalue + "px";
                                let spanid = s_Span.dataset.labelid;
                                thisPositionImageJson(spanid,"top",topvalue);
                            }
                        break;
                }
            }
            else
            {
                alert("未選取標籤");
            }

        });

        //新增標籤
        $('#s_addbuttonLabel').on('click',function(event){
            if($('#s_titleinputLabel').val() != "")
            {
                NEwLAbelSpan();
            }
            else
            {
                alert("未輸入名稱");
            }
        });

        //新增標籤
        function NEwLAbelSpan()
        {
            //判斷目前被選擇的圖片外框
            if(document.querySelector('.s_img_labeBox.active'))
            {
                //抓出對應id
                let Thisbox = document.querySelector('.s_img_labeBox.active');
                let Loadid = ('imgidbox' in Thisbox.dataset ) ? Thisbox.dataset.imgidbox : false;
                let area = AllLabeljson['List']['area'];
                //input抓去
                let areaTag = document.querySelector('[data-status="area"]');
                let buildingTag = document.querySelector('[data-status="building"]');
                let floorTag = document.querySelector('[data-status="floor"]');
                let householdTag = document.querySelector('[data-status="household"]');
                //區域
                if(buildingTag.value == 0 && floorTag.value == 0 && householdTag.value == 0)
                {
                    let index = FindIndexPotion(area,Loadid);
                    let spanlength = area[index]['label'].length;
                    try {
                        let newid = area[index]['label'].length > 0 ? area[index]['label'][spanlength - 1].id + 1 : 1;
                        area[index]['label'].push({"name":$('#s_titleinputLabel').val(),"id":newid,"left":0,"top":0});
                        $('.s_img_labeBox.active').append("<span data-labelname='span' data-labelid='"+newid+"' style='top:0px;left:0px;'>"+$('#s_titleinputLabel').val()+"</span>");
                    }
                    catch (e)
                    {
                        console.error("區域新增標籤失敗");
                    }
                }
                //棟別
                if(buildingTag.value != 0 && floorTag.value == 0 && householdTag.value == 0)
                {
                    try {
                        let areaKeyindex = FindIndexPotion(area,areaTag.value);
                        let buildingTag = document.querySelector('[data-status="building"]');
                        let buildingkey = buildingTag.value;
                        let buildingjson = area[areaKeyindex]['building'];

                        let index = FindIndexPotion(buildingjson,Loadid);
                        let spanlength = buildingjson[index]['label'].length;
                        let newid = buildingjson[index]['label'].length > 0 ? buildingjson[index]['label'][spanlength - 1].id + 1 : 1;
                        buildingjson[index]['label'].push({"name":$('#s_titleinputLabel').val(),"id":newid,"left":0,"top":0});
                        $('.s_img_labeBox.active').append("<span data-labelname='span' data-labelid='"+newid+"' style='top:0px;left:0px;'>"+$('#s_titleinputLabel').val()+"</span>");
                    }
                    catch (e)
                    {
                        console.error("棟別新增標籤失敗");
                    }
                }
                //樓層
                if(buildingTag.value != 0 && floorTag.value != 0 && householdTag.value == 0)
                {
                    try {
                        let areaKeyindex = FindIndexPotion(area,areaTag.value);
                        let buildingTag = document.querySelector('[data-status="building"]');
                        let buildingkey = buildingTag.value;
                        let buildingjson = area[areaKeyindex]['building'];
                        let buildingindex = FindIndexPotion(buildingjson,areaTag.value+"_"+buildingkey);
                        let floorjson = buildingjson[buildingindex]['floor'];

                        let index = FindIndexPotion(floorjson,Loadid);
                        let spanlength = floorjson[index]['label'].length;
                        let newid = floorjson[index]['label'].length > 0 ? floorjson[index]['label'][spanlength - 1].id + 1 : 1;
                        floorjson[index]['label'].push({"name":$('#s_titleinputLabel').val(),"id":newid,"left":0,"top":0});
                        $('.s_img_labeBox.active').append("<span data-labelname='span' data-labelid='"+newid+"' style='top:0px;left:0px;'>"+$('#s_titleinputLabel').val()+"</span>");
                    }
                    catch (e)
                    {
                        console.error("樓層新增標籤失敗");
                    }
                }
                //戶別
                if(buildingTag.value != 0 && floorTag.value != 0 && householdTag.value != 0)
                {
                    try {
                        let areaKeyindex = FindIndexPotion(area,areaTag.value);
                        let buildingTag = document.querySelector('[data-status="building"]');
                        let buildingkey = buildingTag.value;
                        let buildingjson = area[areaKeyindex]['building'];
                        let buildingindex = FindIndexPotion(buildingjson,areaTag.value+"_"+buildingkey);
                        let floorjson = buildingjson[buildingindex]['floor'];
                        let floorkey = areaTag.value+"_"+buildingkey+"_"+floorTag.value;
                        let floorindex = FindIndexPotion(floorjson,floorkey);
                        let householdjson = floorjson[floorindex]['household'];
                        let index = FindIndexPotion(householdjson,Loadid);
                        let spanlength = householdjson[index]['label'].length;
                        let newid = householdjson[index]['label'].length > 0 ? householdjson[index]['label'][spanlength - 1].id + 1 : 1;
                        householdjson[index]['label'].push({"name":$('#s_titleinputLabel').val(),"id":newid,"left":0,"top":0});
                        $('.s_img_labeBox.active').append("<span data-labelname='span' data-labelid='"+newid+"' style='top:0px;left:0px;'>"+$('#s_titleinputLabel').val()+"</span>");
                    }
                    catch (e)
                    {
                        console.error("戶新增標籤失敗");
                    }
                }

                console.log("新增最終結果");
                console.log(AllLabeljson);
            }
        }


        //將位置寫回標籤 spanid 標籤的id  ,Position 位置 left or top  ,values 值
        function thisPositionImageJson(spanid,Position,values)
        {
            //抓出對應id
            let Thisbox = document.querySelector('.s_img_labeBox.active');
            let Loadid = ('imgidbox' in Thisbox.dataset ) ? Thisbox.dataset.imgidbox : false;
            let area = AllLabeljson['List']['area'];
            //區域
            //input抓去
            let areaTag = areavalue;
            let floorTag = floorvalue;
            let householdTag = householdvalue;
            //區域
            if(floorTag.value == 0 && householdTag.value == 0)
            {
                try{
                    let index = FindIndexPotion(area,Loadid);
                    let areajson = area[index].label;
                    let spanindex = FindSpanPotion(areajson,Number(spanid));
                    let spanjson = areajson[spanindex];
                    spanjson[Position] = values;
                }
                catch (e)
                {
                    console.error("區域移動寫回發生錯誤");
                }

            }
            //樓
            if(floorTag.value != 0 && householdTag.value == 0)
            {
                try{
                    let index = FindIndexPotion(area,areaTag.value);
                    let areajson = area[index]['floor'];
                    let floorkey = areaTag.value+"_F"+floorTag.value;
                    let floorindex = FindIndexPotion(areajson,floorkey);
                    let floorjson = areajson[floorindex]['label'];
                    let spanindex = FindSpanPotion(floorjson,Number(spanid));
                    let spanjson = floorjson[spanindex];
                    spanjson[Position] = values;
                }
                catch (e)
                {
                    console.error("樓移動寫回發生錯誤");
                }
            }
            //樓
            // if(buildingTag.value != 0 && floorTag.value != 0 && householdTag.value == 0)
            // {
            //     try{
            //         let index = FindIndexPotion(area,areaTag.value);
            //         let areajson = area[index]['building'];
            //         let areakey = areaTag.value+"_"+buildingTag.value;
            //         let buildingindex = FindIndexPotion(areajson,areakey);
            //         let buildingjson = areajson[buildingindex]['floor'];
            //         let floorkey = areaTag.value + "_"+buildingTag.value+"_"+floorTag.value;
            //         let floorindex = FindIndexPotion(buildingjson,floorkey);
            //         let floorjson = buildingjson[floorindex].label;
            //         let spanindex = FindSpanPotion(floorjson,Number(spanid));
            //         let spanjson = floorjson[spanindex];
            //         spanjson[Position] = values;
            //     }
            //     catch (e)
            //     {
            //         console.error("樓移動寫回發生錯誤");
            //     }
            // }
            //戶
            if(floorTag.value != 0 && householdTag.value != 0)
            {
                try{
                    let index = FindIndexPotion(area,areaTag.value);
                    let areajson = area[index]['floor'];
                    let floorkey = areaTag.value+"_F"+floorTag.value;
                    let floorindex = FindIndexPotion(areajson,floorkey);
                    // return false
                    if(floorindex == -1)
                    {
                        console.error("戶尋找樓的json失敗！請查看是否json內沒有值"+ floorkey);
                        return false;
                    }
                    let floorjson = areajson[floorindex]['household'];
                    let householdkey = floorkey+"_H"+householdTag.value;
                    let householdindex = FindIndexPotion(floorjson,householdkey);
                    if(householdindex == -1)
                    {
                        console.error("戶尋找json失敗！請查看是否json內沒有值");
                        return false;
                    }
                    let householdjson = floorjson[householdindex]['label'];
                    let spanindex = FindSpanPotion(householdjson,Number(spanid));
                    let spanjson = householdjson[spanindex];
                    spanjson[Position] = values;
                }
                catch (e)
                {
                    console.error("戶移動寫回發生錯誤");
                }
            }
            console.log("將位置寫回標籤");
            console.log(AllLabeljson);
        }

        //尋找所在位置回傳span
        function FindSpanPotion(List,spanid)
        {
            var index = $.map(List, function(item, index) {
                return item.id;
            }).indexOf(spanid);

            return index;
        }

        //切換棟別
        s_ChangeTypeImage.addEventListener('change',event =>{
            let target = event.target;
            let values = target.value;
            let status = ('status' in target.dataset) ? target.dataset.status : false;
            try {
                ChangeAllSelect(target,values,status);
            }
            catch (e) {
                console.error("切換出現錯誤");
            }
        });

        //切換執行區、棟、樓、戶
        async function ChangeAllSelect(target,values,status)
        {
            //用來判斷圖片是否開啟
            let ImageTool = false;

            //取得區域值
            let areakey = areavalue.value;

            //取得主key
            let JsonKEy = AllJsonKEyJsonTitle();
            if(!JsonKEy && JsonKEy.length == 0)
            {
                console.error("取得 AllJsonKEy 的key值失敗，這是用來比對json階層的主Key");
                return false
            }

            //區域json
            let area = AllLabeljson['List'][JsonKEy[0]];

            //區域(階層1預設)
            if(status == JsonKEy[0])
            {
                //抓取資料
                var index = $.map(area, function(item, index) {
                    return item.tag;
                }).indexOf(values);

                //如果棟別切換，其他下拉選單清除
                floorvalue.value = 0;
                householdvalue.value = 0;

                //清除其他選項
                Clear_Changebar(JsonKEy[0]);

                //先判斷是否有圖片
                ImageTool = NewImageBoxOpen(areakey);
                if(ImageTool)
                {
                    //開啟新的圖片
                    let newactivebox = document.querySelector('[data-imgidbox="'+values+'');
                    newactivebox.classList.add('active');
                    newactivebox.classList.remove('d-none');
                    //載入標籤(待修)
                    S_LabelLOAD(area[index].label);
                }
                else
                {
                    //初始化
                    Clear_OldIMAgeFirstBox(areavalue);
                }
            }

            //樓(階層2)
            if(status == JsonKEy[1])
            {
                //清除其他選項
                Clear_Changebar(JsonKEy[1]);

                //取得區域值(階層1)
                console.log("區域值");
                console.log(areakey);
                //取得樓(階層2)
                let floorvaluevalue = floorvalue.value!= 0 ? floorvalue.value : false;
                console.log("樓值");
                console.log(floorvaluevalue);

                if(!floorvaluevalue)
                {
                   console.error("ChangeAllSelect() 取得不到樓層");
                   return false
                }

                if(floorvaluevalue){

                    //取得json資料區域
                    var index = $.map(area, function(item, index) {
                        return item.tag;
                    }).indexOf(areakey);

                    //取得json資料樓
                    let floor = area[index]['floor'];
                    let floorkey = areakey+"_F"+floorvaluevalue;
                    var flindex = $.map(floor, function(item, index) {
                        return item.tag;
                    }).indexOf(floorkey);

                    if(flindex == -1)
                    {
                        console.error('可能json與頁面html不同步，沒有'+floorkey+"，請檢查放置圖片的外框或AllLabeljson");
                    }
                    else
                    {
                        //先判斷是否有圖片
                        ImageTool = NewImageBoxOpen(floorkey);

                        if(!ImageTool)
                        {
                            //初始化
                            Clear_OldIMAgeFirstBox(floorvalue);
                            return false
                        }

                        //載入標籤
                        if(floor[flindex].label && floor[flindex].label.length >= 0)
                        {
                            S_LabelLOAD(floor[flindex].label);
                        }
                        else
                        {
                            console.log("無標籤");
                        }
                    }
                }

            }

            //戶(階層3)
            if(status == JsonKEy[2])
            {
                //取得區域值
                console.log("區域值");
                console.log(areakey);
                //取得樓(階層2)
                let floorvaluevalue = floorvalue.value;
                console.log("樓值");
                console.log(floorvaluevalue);
                //取得戶(階層3)
                let householdvalue = document.querySelector('[data-status="'+JsonKEy[2]+'"]');
                let householdvaluevalue = householdvalue.value;
                console.log("戶值");
                console.log(householdvaluevalue);

                if(floorvaluevalue == 0)
                {
                    householdvalue.value = 0;
                    alert("請依序選擇、樓、戶");
                }
                else
                {
                    //取得json資料區域
                    var index = $.map(area, function(item, index) {
                        return item.tag;
                    }).indexOf(areakey);

                    if(index == -1)
                    {
                        console.error("區域尋找資料失敗！可能json檔案沒有區域 " + areakey);
                        return false;
                    }

                    //取得json資料樓(階層2)
                    let floor = area[index][JsonKEy[1]];
                    let floorkey = areakey+"_F"+floorvaluevalue;
                    var flindex = $.map(floor, function(item, index) {
                        return item.tag;
                    }).indexOf(floorkey);

                    if(flindex == -1)
                    {
                        console.error("樓尋找資料失敗！可能json檔案沒有樓 " + floorkey);
                        return false;
                    }
                    //取得json資料戶(階層3)
                    let household = floor[flindex][JsonKEy[2]];
                    let householdkey = floorkey+"_H"+householdvaluevalue;
                    if(!household)
                    {
                        alert("沒有戶的資料");
                        householdvalue.value = 0;
                        return false;
                    }

                    var hoindex = $.map(household, function(item, index) {
                        return item.tag;
                    }).indexOf(householdkey);
                    if(hoindex == -1)
                    {
                        console.error("戶尋找資料失敗！可能json檔案沒有戶 "+householdkey);
                        return false;
                    }

                    let Endjson = household[hoindex];

                    //先判斷是否有圖片
                    ImageTool = NewImageBoxOpen(householdkey);
                    if(!ImageTool)
                    {
                        //初始化
                        Clear_OldIMAgeFirstBox(householdvalue);
                        floorvalue.value = 0;
                        return false
                    }

                    //載入標籤
                    if(Endjson && ImageTool)
                    {
                        S_LabelLOAD(Endjson.label);
                    }
                    else
                    {
                        console.error('json檔案內無此資料'+householdkey);
                    }
                }
            }
        }

        //初始化
        //因為沒有圖片，所以自動返回預設值
        function Clear_OldIMAgeFirstBox(thisSelect,status)
        {
            //取得主key
            let JsonKEy = AllJsonKEyJsonTitle();
            if(!JsonKEy && JsonKEy.length == 0)
            {
                console.error("取得 AllJsonKEy 的key值失敗，這是用來比對json階層的主Key，Clear_OldIMAgeFirstBox()");
                return false
            }
            //區域json
            let area = AllLabeljson['List'][JsonKEy[0]];
            console.log("初始化執行");
            console.log(thisSelect);


            //如果沒有圖片返回預設，區域的預設為0
            if(thisSelect == document.querySelector('[data-status="area"]'))
            {
                document.querySelector('[data-status="area"]').value = 'A0';
            }
            else
            {
                document.querySelector('[data-status="area"]').value = 'A0';
                thisSelect.value = 0;
            }

            //如果是清除按鈕，就不跳提示
            if(status != "clear")
            {
                //取得原本的選擇名稱
                const text = thisSelect.options[thisSelect.selectedIndex].text;
                alert(text+"區未上傳圖片");
            }


            //將畫面也切換到預設(避免每一個選擇都是空的，導致畫面與Select所在位置都不同)
            //先將舊的照片關閉
            Clear_ChangeImageBox();
            document.querySelector('[data-imgidbox="'+presetValue+'"]').classList.add('active');
            document.querySelector('[data-imgidbox="'+presetValue+'"]').classList.remove('d-none');
            //載入標籤
            let areaindex = FindIndexPotion(area,presetValue);
            let json = area[areaindex].label;
            S_LabelLOAD(json);
        }

        //開啟新的圖片
        function NewImageBoxOpen(status)
        {
            //清除輸入名稱的欄位
            //$('#s_titleinputLabel').val("");

            //開啟新的
            let newbox = document.querySelector('[data-imgidbox="'+status+'"]');
            if(newbox)
            {
                //判斷有沒有圖片
                let Images = $('[data-imgidbox="'+status+'"]').find('img') ? $('[data-imgidbox="'+status+'"]').find('img') : false;
                let ImageSrC = Images != false ? ( Images.attr('src')!= "" ? Images.attr('src') : false ) : false;
                console.log("//判斷有沒有圖片");
                console.log(ImageSrC);

                if(ImageSrC)
                {
                    console.log("//先將標籤關閉");
                    //先將標籤關閉
                    Clear_SpanLAbel();
                    //先將舊的照片關閉
                    Clear_ChangeImageBox();

                    newbox.classList.add('active');
                    newbox.classList.remove('d-none');
                    return true
                }
                else
                {
                    return false
                }
            }
            else
            {
                console.error('讀取切換數值出錯,可能沒有這個圖片框 ， tag :'+status);
                return false
            }
        }

        //將舊的圖片框與標籤清除
        function Clear_ChangeImageBox()
        {
            let ImageBox = document.querySelector('[data-labelname="imgbox"].active');
            if(ImageBox)
            {
                ImageBox.classList.add('d-none');
                ImageBox.classList.remove('active');
            }

        }

        //清除切換
        function Clear_Changebar(status)
        {
            //取得區域
            try
            {
                let areavalue = document.querySelector('[data-status="area"]');
                let floorvalue = document.querySelector('[data-status="floor"]');
                let householdvalue = document.querySelector('[data-status="household"]');
                if(status == "area")
                {
                    floorvalue.value = 0;
                    householdvalue.value = 0;
                }

                if(status == "floor" && householdvalue)
                {
                    householdvalue.value = 0;
                }
            }
            catch
            {
                console.error("清除選單失敗");
            }

        }


        //儲存目前的標籤
        function SaveImageBuTTon()
        {

            //取得區域key
            let newJson = AllLabeljson;
            let area = newJson["List"]['area'];
            let LabelObjlenght = LabelObj.length;
            let LabelObjkey = Object.keys(LabelObj);
            //區域回寫
            for(let i=0; i<LabelObjkey.length; i++)
            {
                if(area[i] && LabelObj[area[i].tag && area[i].tag])
                {
                    area[i].label = LabelObj[area[i].tag];
                }
            }
            //棟抓出key
            let areassplit = [];
            let floorsplit = [];
            let householdsplit = [];
            for(let i=0; i<LabelObjkey.length; i++)
            {
                if(LabelObjkey[i].length == 4)
                {
                    //拆解字串，抓出區域
                    areassplit.push(LabelObjkey[i].split('_'));

                }
                if(LabelObjkey[i].length == 7)
                {
                    //拆解字串，抓出樓
                    floorsplit.push(LabelObjkey[i].split('_'));
                }

                if(LabelObjkey[i].length == 10)
                {
                    //拆解字串，抓出戶
                    householdsplit.push(LabelObjkey[i].split('_'));
                }
            }
            //棟回寫
            for(let i=0; i<areassplit.length; i++)
            {
                //先找出區域的位置
                var result = $.map(area, function(item, index) {
                    return item.tag;
                }).indexOf(areassplit[i][0]);

                let buildingArray = area[result]["building"];

                //找出樓的棟
                let key = areassplit[i][0]+"_"+areassplit[i][1];
                var building = $.map(buildingArray, function(item, index) {
                    return item.tag;
                }).indexOf(key);
                buildingArray[building].label = LabelObj[key];
            }
            //樓回寫
            //console.log(floorsplit);
            for(let i=0; i<floorsplit.length; i++)
            {
                //先找出區域的位置
                var result = $.map(area, function(item, index) {
                    return item.tag;
                }).indexOf(floorsplit[i][0]);

                let buildingArray = area[result]["building"];

                //找出棟
                let key = floorsplit[i][0]+"_"+floorsplit[i][1];
                var building = $.map(buildingArray, function(item, index) {
                    return item.tag;
                }).indexOf(key);

                let floorArray = area[result]["building"][building].floor;

                //找出樓
                let keyfloor = floorsplit[i][0]+"_"+floorsplit[i][1]+"_"+floorsplit[i][2];
                var floorindex = $.map(floorArray, function(item, index) {
                    return item.tag;
                }).indexOf(keyfloor);

                //將樓寫回去
                floorArray[floorindex].label = LabelObj[keyfloor];
            }
            //戶回寫
            for(let i=0; i<householdsplit.length; i++)
            {
                //先找出區域的位置
                var result = $.map(area, function(item, index) {
                    return item.tag;
                }).indexOf(householdsplit[i][0]);

                let buildingArray = area[result]["building"];

                //找出棟
                let key = householdsplit[i][0]+"_"+householdsplit[i][1];
                var building = $.map(buildingArray, function(item, index) {
                    return item.tag;
                }).indexOf(key);

                let floorArray = area[result]["building"][building].floor;

                //找出樓
                let keyfloor = householdsplit[i][0]+"_"+householdsplit[i][1]+"_"+householdsplit[i][2];
                var floorindex = $.map(floorArray, function(item, index) {
                    return item.tag;
                }).indexOf(keyfloor);

                let householdArray = area[result]["building"][building].floor[floorindex].household;

                let keyhousehold = householdsplit[i][0]+"_"+householdsplit[i][1]+"_"+householdsplit[i][2]+"_"+householdsplit[i][3];
                var householdindex = $.map(householdArray, function(item, index) {
                    return item.tag;
                }).indexOf(keyhousehold);

                //戶 寫回去
                householdArray[householdindex].label = LabelObj[keyhousehold];

            }
        }

        //更換圖片
        $('#s_ImageLabel').on('click',function(event){
            //區域
            //input抓去
            $('#s_ImageLabelfile').click();
        });

        $('#s_ImageLabelfile').on('change',function(event){
            //圖片上傳
            //更換圖片
            const curFile = event.target.files[0]; // 透過 input 取得的 file object
            const objectURL = URL.createObjectURL(curFile);
            console.log('objectURL', objectURL);
            //檔案存起來
            var Formdata = new FormData();
            Formdata.append('file', curFile);
            //更換區塊圖片
            //取得區域
            let area = AllLabeljson['List']['area'];
            let areavalue = document.querySelector('[data-status="area"]');
            let buildingvalue = document.querySelector('[data-status="building"]');
            let floorvalue = document.querySelector('[data-status="floor"]');
            let householdvalue = document.querySelector('[data-status="household"]');
            //區域(展示用)
            if(buildingvalue.value == 0 && floorvalue.value == 0 && householdvalue.value == 0)
            {
                let areaindex = FindIndexPotion(area,areavalue.value);
                let areajson = area[areaindex];
                let areaImage = areajson.img = objectURL;
                $('[data-imgidbox="'+areavalue.value+'"]').find('img').attr('src',areaImage);
                console.log(areajson);
            }

            //棟(展示用)
            if(buildingvalue.value != 0 && floorvalue.value == 0 && householdvalue.value == 0)
            {
                let areaindex = FindIndexPotion(area,areavalue.value);
                let areajson = area[areaindex]['building'];
                let buildingkey = areavalue.value+"_"+buildingvalue.value;
                let buildingindex = FindIndexPotion(areajson,buildingkey);
                let buildingjson = areajson[buildingindex];
                let buildingImage = buildingjson.img = objectURL;
                $('[data-imgidbox="'+buildingkey+'"]').find('img').attr('src',buildingImage);
            }

            //樓(展示用)
            if(buildingvalue.value != 0 && floorvalue.value != 0 && householdvalue.value == 0)
            {
                let areaindex = FindIndexPotion(area,areavalue.value);
                let areajson = area[areaindex]['building'];
                let buildingkey = areavalue.value+"_"+buildingvalue.value;
                let buildingindex = FindIndexPotion(areajson,buildingkey);
                let buildingjson = areajson[buildingindex]['floor'];
                let floorkey = areavalue.value+"_"+buildingvalue.value+"_"+floorvalue.value;
                let floorindex = FindIndexPotion(buildingjson,floorkey);
                let floorjson = buildingjson[floorindex];
                let floorImage = floorjson.img = objectURL;
                $('[data-imgidbox="'+floorkey+'"]').find('img').attr('src',floorImage);
            }
            //戶(展示用)
            if(buildingvalue.value != 0 && floorvalue.value != 0 && householdvalue.value != 0)
            {
                let areaindex = FindIndexPotion(area,areavalue.value);
                let areajson = area[areaindex]['building'];
                let buildingkey = areavalue.value+"_"+buildingvalue.value;
                let buildingindex = FindIndexPotion(areajson,buildingkey);
                let buildingjson = areajson[buildingindex]['floor'];
                let floorkey = areavalue.value+"_"+buildingvalue.value+"_"+floorvalue.value;
                let floorindex = FindIndexPotion(buildingjson,floorkey);
                let floorjson = buildingjson[floorindex]['household'];
                let householdkey = areavalue.value+"_"+buildingvalue.value+"_"+floorvalue.value+"_"+householdvalue.value;
                let householdindex = FindIndexPotion(floorjson,householdkey);
                let householdjson = floorjson[householdindex];
                let householdImage = householdjson.img = objectURL;
                $('[data-imgidbox="'+householdkey+'"]').find('img').attr('src',householdImage);
            }


            //移除標籤
            DelSpanLabel();
            //ajax

            // $.ajax({
            //     type:'POST',
            //     url: $(this).attr('action'),
            //     data:Formdata,
            //     cache:false,
            //     contentType: false,
            //     processData: false,
            //     success:function(data){
            //         console.log("success");
            //         console.log(data);
            //     },
            //     error: function(data){
            //         console.log("error");
            //         console.log(data);
            //     }
            // });
        });

        //移除標籤
        function DelSpanLabel()
        {
            let activeTag = document.querySelector('.s_img_labeBox.active');
            if(activeTag)
            {
                //移除span標籤
                let spanAll = activeTag.querySelectorAll('[data-labelname="span"]');
                spanAll.forEach(item=>{
                    item.remove();
                });
                //移除json內的span標籤
                JsonDelSpanLabel();
            }
            else
            {
                consle.error('沒有被選擇的圖片外框 s_img_labeBox 缺少 active');
            }
        }

        function JsonDelSpanLabel()
        {
            let area = document.querySelector('[data-status="area"]');
            let building = document.querySelector('[data-status="building"]');
            let floor = document.querySelector('[data-status="floor"]');
            let household = document.querySelector('[data-status="household"]');

            let areajson = AllLabeljson['List']['area'];
            //區域移除span
            if(building.value == 0 && floor.value == 0 && household.value == 0)
            {
                let areavalue = area.value;
                let areaindex = FindIndexPotion(areajson,areavalue);
                let areafilter = areajson[areaindex];
                areafilter.label = [];
            }
            //棟(展示用)
            if(building.value != 0 && floor.value == 0 && household.value == 0)
            {
                let areaindex = FindIndexPotion(areajson,area.value);
                let areafilter = areajson[areaindex]['building'];
                let buildingkey = area.value+"_"+building.value;
                let buildingindex = FindIndexPotion(areafilter,buildingkey);
                let buildingfilter = areafilter[buildingindex];
                buildingfilter.label = [];
            }
            //樓(展示用)
            if(building.value != 0 && floor.value != 0 && household.value == 0)
            {
                let areaindex = FindIndexPotion(areajson,area.value);
                let areafilter = areajson[areaindex]['building'];
                let buildingkey = area.value+"_"+building.value;
                let buildingindex = FindIndexPotion(areafilter,buildingkey);
                let buildingfilter = areafilter[buildingindex]['floor'];
                let floorkey = buildingkey+"_"+floor.value;
                let floorindex = FindIndexPotion(buildingfilter,floorkey);
                let floorfilter = buildingfilter[floorindex];
                floorfilter.label = [];
            }
            //戶(展示用)
            if(building.value != 0 && floor.value != 0 && household.value != 0)
            {
                let areaindex = FindIndexPotion(areajson,area.value);
                let areafilter = areajson[areaindex]['building'];
                let buildingkey = area.value+"_"+building.value;
                let buildingindex = FindIndexPotion(areafilter,buildingkey);
                let buildingfilter = areafilter[buildingindex]['floor'];
                let floorkey = buildingkey+"_"+floor.value;
                let floorindex = FindIndexPotion(buildingfilter,floorkey);
                let floorfilter = buildingfilter[floorindex]['household'];
                let householdkey = floorkey + "_"+household.value;
                let householdindex = FindIndexPotion(floorfilter,householdkey);
                let householdfilter = floorfilter[householdindex];
                householdfilter.label = [];
            }

            console.log(AllLabeljson);
        }


        //存儲標籤
        $('#s_SavebuttonLabel').on('click',function(event){
            let typeid = $('#type').val();
            //存擋後的動作
            console.log(AllLabeljson);
        });

        //尋找所在位置回傳index
        function FindIndexPotion(List,Loadid)
        {
            var index = $.map(List, function(item, index) {
                return item.tag;
            }).indexOf(Loadid);

            return index;
        }

        //取得 AllJsonKEy 所有key值
        function AllJsonKEyJsonTitle()
        {
            let Key = Object.keys(AllJsonKEy);
            return Key
        }

        //清除舊標籤 Span
        function Clear_SpanLAbel()
        {
            if(document.querySelector('[data-labelname="imgbox"].active'))
            {
                let oldimgbox = document.querySelector('[data-labelname="imgbox"].active');
                let spanAll = oldimgbox.querySelectorAll('[data-labelname="span"]');
                if(spanAll)
                {
                    let spanAll = document.querySelectorAll('[data-labelname="span"]');
                        spanAll.forEach(item=>{
                            item.remove();
                    });
                }
            }
        }

    </script>


</body>
</html>